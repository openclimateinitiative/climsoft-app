"use strict";(self.webpackChunkclimsoft_app=self.webpackChunkclimsoft_app||[]).push([[904],{2720:(I,T,r)=>{r.d(T,{i:()=>G});var Z=r(2835),n=r(461),c=r(9133),A=r(273),e=r(3668),_=r(4437),u=r(2606),f=r(6019),C=r(2409),a=r(576),s=r(8063),p=r(5154),m=r(9463),h=r(7384),v=r(3067),P=r(4753),O=r(8305),U=r(6921),S=r(2997),b=r(1109),x=r(9097);function E(o,l){1&o&&(e.TgZ(0,"div",4),e._UZ(1,"img",5),e._uU(2," searching..."),e.qZA())}function F(o,l){if(1&o&&(e.TgZ(0,"div",6),e.TgZ(1,"div",7),e._uU(2),e.qZA(),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(t.errorMessage)}}function D(o,l){if(1&o&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&o){const t=l.item;e.xp6(1),e.Oqu(t.form_id)}}const M=function(o){return{loading:o}};let q=(()=>{class o{constructor(t){this.archiveService=t,this.placeholder="Classified Into",this.onSelection=new e.vpe,this.typeaheadLoading=!1,this.typeaheadNoResults=!1,this.loading=!1,this.search="",this.errorMessage=""}ngOnInit(){this.definitions$=new O.y(t=>{t.next(this.search)}).pipe((0,m.b)(400),(0,h.b)(()=>{this.errorMessage="",this.loading=!0}),(0,v.w)(t=>t?this.archiveService.searchDefinitions(t).pipe((0,h.b)(()=>{this.loading=!1}),(0,P.U)(i=>i.result||[]),(0,h.b)(()=>U.Z,i=>{this.loading=!1,this.errorMessage=i&&i.message||"search failed"}),(0,Z.K)(i=>(this.errorMessage="search failed",(0,S.of)(i)))):(0,S.of)([])))}changeTypeaheadLoading(t){this.typeaheadLoading=t}onSelect(t){this.selected=t.item,this.onSelection.emit(t.item)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(b.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-archive-definition-selection"]],inputs:{placeholder:"placeholder"},outputs:{onSelection:"onSelection"},decls:5,vars:11,consts:[["typeaheadOptionField","station_name","autocomplete","off","autocorrect","off",1,"form-control",3,"ngModel","typeahead","typeaheadAsync","typeaheadOptionsLimit","typeaheadItemTemplate","ngClass","placeholder","ngModelChange","typeaheadLoading","typeaheadOnSelect"],["class","typeahead-loading",4,"ngIf"],["ngClass","typeahead-error","class","typeahead-loading",4,"ngIf"],["itemTemplate",""],[1,"typeahead-loading"],["src","./assets/img/gif/spinner.gif","alt",""],["ngClass","typeahead-error",1,"typeahead-loading"],[1,"typeahead-error-inner"],[1,"item-heading"]],template:function(t,i){if(1&t&&(e.TgZ(0,"input",0),e.NdJ("ngModelChange",function(g){return i.search=g})("typeaheadLoading",function(g){return i.changeTypeaheadLoading(g)})("typeaheadOnSelect",function(g){return i.onSelect(g)}),e.qZA(),e.YNc(1,E,3,0,"div",1),e.YNc(2,F,3,1,"div",2),e.YNc(3,D,2,1,"ng-template",null,3,e.W1O)),2&t){const d=e.MAs(4);e.Q6J("ngModel",i.search)("typeahead",i.definitions$)("typeaheadAsync",!0)("typeaheadOptionsLimit",7)("typeaheadItemTemplate",d)("ngClass",e.VKq(9,M,i.typeaheadLoading))("placeholder",i.placeholder),e.xp6(1),e.Q6J("ngIf",i.loading),e.xp6(1),e.Q6J("ngIf",!i.loading&&i.errorMessage)}},directives:[c.Fj,c.JJ,c.On,x.Bp,f.mk,f.O5],styles:[""]}),o})();const $=["imageUploader"];function J(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",21),e.TgZ(1,"div",22),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"a",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().resetStation()}),e.O4$(),e._UZ(5,"svg",24),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.station.station_name)}}function N(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"app-station-selection",25),e.NdJ("onSelection",function(d){return e.CHM(t),e.oxw().onStationSelect(d)}),e.qZA()}}function L(o,l){1&o&&(e.TgZ(0,"div"),e.O4$(),e._UZ(1,"svg",28),e._uU(2," Belongs to is required."),e.qZA())}function Q(o,l){if(1&o&&(e.TgZ(0,"div",26),e.YNc(1,L,3,0,"div",27),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.belongs_to.errors.required)}}function w(o,l){1&o&&(e.TgZ(0,"div"),e.O4$(),e._UZ(1,"svg",28),e._uU(2," Form date time not selected."),e.qZA())}function K(o,l){if(1&o&&(e.TgZ(0,"div",26),e.YNc(1,w,3,0,"div",27),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.form_datetime.errors.required)}}function Y(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",21),e.TgZ(1,"div",22),e.TgZ(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"a",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().resetDefinition()}),e.O4$(),e._UZ(5,"svg",24),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.definition.form_id)}}function V(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"app-archive-definition-selection",25),e.NdJ("onSelection",function(d){return e.CHM(t),e.oxw().onDefinitionSelect(d)}),e.qZA()}}function R(o,l){1&o&&(e.TgZ(0,"div"),e.O4$(),e._UZ(1,"svg",28),e._uU(2," Element not selected."),e.qZA())}function B(o,l){if(1&o&&(e.TgZ(0,"div",26),e.YNc(1,R,3,0,"div",27),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.classified_into.errors.required)}}function W(o,l){1&o&&(e.TgZ(0,"div"),e.O4$(),e._UZ(1,"svg",28),e._uU(2," Element not selected."),e.qZA())}function j(o,l){if(1&o&&(e.TgZ(0,"div",26),e.YNc(1,W,3,0,"div",27),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.classified_into.errors.required)}}const y=function(o){return{"is-invalid":o}};let G=(()=>{class o{constructor(t){this.dialogRef=t,this.onClose=new A.x,this.submitted=!1,this.error=""}ngOnInit(){this.form=new c.cw({belongs_to:new c.NI("",c.kI.required),form_datetime:new c.NI("",c.kI.required),classified_into:new c.NI("",c.kI.required),image:new c.NI(null)}),this.fromStation&&(this.station=this.fromStation,this.f.belongs_to.setValue(this.fromStation.station_id))}get update(){return!!this.archive}get f(){return this.form.controls}onStationSelect(t){this.station=t,this.form.controls.belongs_to.setValue(t.station_id)}resetStation(){this.station=void 0,this.form.controls.station.reset()}onFormDateChanged(t){this.form.controls.form_datetime.setValue(t)}onDefinitionSelect(t){this.definition=t,this.form.controls.classified_into.setValue(t.form_id)}resetDefinition(){this.definition=void 0,this.form.controls.classified_into.reset()}onImage(t){console.log(t)}onSubmit(t){console.log(this.form.value),this.error="",this.submitted=!0,console.log(this.form.invalid),!this.form.invalid&&this.imageUploader.upload().pipe((0,Z.K)(i=>{throw this.error="Image upload failed",new Error(i.nessage)}),(0,n.h)(i=>i.result&&i.result.length)).subscribe(i=>{this.form.controls.image.setValue(i.result[0].filepath),this.onClose.next(this.form.value),this.dialogRef.hide()})}onCancel(){this.onClose.next(!1),this.dialogRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.UZ))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-paper-archive-form"]],viewQuery:function(t,i){if(1&t&&e.Gf($,5),2&t){let d;e.iGM(d=e.CRH())&&(i.imageUploader=d.first)}},inputs:{archive:"archive",fromStation:"fromStation"},decls:44,vars:23,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[1,"modal-body"],["cForm","","novalidate","",3,"formGroup","ngSubmit"],["xs","12"],[1,"mb-2"],["cLabel","","for","belongs_to"],["id","belongs_to","type","hidden","formControlName","belongs_to","aria-label","default input","cFormControl","","placeholder","Refers To",3,"ngClass"],["class","typeahead-selection theme form-group",4,"ngIf"],[3,"onSelection",4,"ngIf"],["col","12","class","invalid-feedback",4,"ngIf"],["cLabel","","for","form_datetime"],["error","form datetime is required.",3,"current","submitted","onChange"],["cLabel","","for","classified_into"],["id","classified_into","type","hidden","formControlName","classified_into","aria-label","default input","cFormControl","","placeholder","Classified Into",3,"ngClass"],["id","image","type","hidden","formControlName","image","aria-label","default input","cFormControl","","placeholder","Network Type",3,"ngClass"],[3,"feature","onImgSelect"],["imageUploader",""],["xs","12",1,"text-end","pt-3"],["type","submit",1,"btn","btn-dark","mx-1"],["type","button",1,"btn","btn-dark",3,"click"],[1,"typeahead-selection","theme","form-group"],[1,"typeahead-selection-inner"],[1,"btn",3,"click"],["cIcon","","name","cilX"],[3,"onSelection"],["col","12",1,"invalid-feedback"],[4,"ngIf"],["cIcon","","name","cilXCircle"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"h5",1),e._uU(2),e.qZA(),e.qZA(),e.TgZ(3,"div",2),e.TgZ(4,"form",3),e.NdJ("ngSubmit",function(g){return i.onSubmit(g)}),e.TgZ(5,"c-row"),e.TgZ(6,"c-col",4),e.TgZ(7,"div",5),e.TgZ(8,"label",6),e._uU(9,"Belongs To"),e.qZA(),e._UZ(10,"input",7),e.YNc(11,J,6,1,"div",8),e.YNc(12,N,1,0,"app-station-selection",9),e.YNc(13,Q,2,1,"div",10),e.qZA(),e.qZA(),e.TgZ(14,"c-col",4),e.TgZ(15,"div",5),e.TgZ(16,"label",11),e._uU(17,"Form Date/Time"),e.qZA(),e.TgZ(18,"app-data-time",12),e.NdJ("onChange",function(g){return i.onFormDateChanged(g)}),e.qZA(),e.YNc(19,K,2,1,"div",10),e.qZA(),e.qZA(),e.TgZ(20,"c-col",4),e.TgZ(21,"div",5),e.TgZ(22,"label",13),e._uU(23,"Classified Into"),e.qZA(),e._UZ(24,"input",14),e.YNc(25,Y,6,1,"div",8),e.YNc(26,V,1,0,"app-archive-definition-selection",9),e.YNc(27,B,2,1,"div",10),e.qZA(),e.qZA(),e.TgZ(28,"c-col",4),e.TgZ(29,"div",5),e.TgZ(30,"label",13),e._uU(31,"Image"),e.qZA(),e._UZ(32,"input",15),e.TgZ(33,"app-image-uploader",16,17),e.NdJ("onImgSelect",function(g){return i.onImage(g)}),e.qZA(),e.YNc(35,j,2,1,"div",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(36,"c-row"),e.TgZ(37,"c-col",4),e._UZ(38,"hr"),e.qZA(),e.TgZ(39,"c-col",18),e.TgZ(40,"button",19),e._uU(41),e.qZA(),e.TgZ(42,"button",20),e.NdJ("click",function(){return i.onCancel()}),e._uU(43,"Cancel"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.hij("",i.update?"Update":"Add"," Paper Archive"),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(6),e.Q6J("ngClass",e.VKq(17,y,(i.submitted||i.f.belongs_to.touched)&&i.f.belongs_to.invalid)),e.xp6(1),e.Q6J("ngIf",i.station),e.xp6(1),e.Q6J("ngIf",!i.station),e.xp6(1),e.Q6J("ngIf",i.f.belongs_to.errors),e.xp6(5),e.Q6J("current",i.f.form_datetime.value)("submitted",i.submitted),e.xp6(1),e.Q6J("ngIf",i.f.form_datetime.errors),e.xp6(5),e.Q6J("ngClass",e.VKq(19,y,(i.submitted||i.f.classified_into.touched)&&i.f.classified_into.invalid)),e.xp6(1),e.Q6J("ngIf",i.definition),e.xp6(1),e.Q6J("ngIf",!i.definition),e.xp6(1),e.Q6J("ngIf",i.f.classified_into.errors),e.xp6(5),e.Q6J("ngClass",e.VKq(21,y,(i.submitted||i.f.image.touched)&&i.f.image.invalid)),e.xp6(1),e.Q6J("feature","feature"),e.xp6(2),e.Q6J("ngIf",i.f.classified_into.errors),e.xp6(6),e.Oqu(i.update?"Update":"Add"))},directives:[c._Y,c.JL,u.$_X,c.sg,u.iok,u.Yp0,u.eFW,c.Fj,u.oHf,c.JJ,c.u,f.mk,f.O5,C.o,a.$,s.ar,p.n,q],styles:[""]}),o})()},1109:(I,T,r)=>{r.d(T,{f:()=>u});var Z=r(4499),n=r(2835),c=r(7384),A=r(3668),e=r(453);const _="climsoft/v1";let u=(()=>{class f{constructor(a){this.http=a,this.archives$=new Z.X({archives:[],limit:10,page:1,pages:1}),this.init=!1;const s=this.archives$.getValue();this.getArchives(s.page,s.limit)}get archives(){return this.archives$.asObservable()}getArchives(a,s){console.log(a,s),this.http.GET(`${_}/paper-archives?limit=${s}&offset=${(a-1)*s}`).subscribe(m=>{console.log(m),this.archives$.next({archives:m.result,limit:s,page:m.page,pages:m.pages}),this.init=!0})}getStationArchives(a){return this.http.GET(`${_}/paper-archives?belongs_to=${a}`)}updateState(a){if(a.page){const s=this.archives$.getValue().limit;this.getArchives(a.page,s)}a.limit&&this.getArchives(1,a.limit)}addArchive(a){return this.http.POST(`${_}/paper-archives`,Object.assign({},a)).pipe((0,n.K)(s=>{throw new Error(s.error.message)}),(0,c.b)(s=>{console.log(s);const p=this.archives$.getValue(),{page:m,limit:h}=p;this.getArchives(m,h)}))}getArchive(a){return this.http.GET(`${_}/paper-archives/${a.belongs_to}/${a.form_datetime}/${a.classified_into}`)}updateArchive(a,s){return this.http.PUT(`${_}/paper-archives/${a.belongs_to}/${a.form_datetime}/${a.classified_into}`,s).pipe((0,n.K)(m=>{throw new Error(m.error.message)}),(0,c.b)(m=>{const h=this.archives$.getValue(),{page:v,limit:P}=h;this.getArchives(v,P)}))}removeArchive(a){this.http.DELETE(`${_}/paper-archives/${a.belongs_to}/${a.form_datetime}/${a.classified_into}`).pipe((0,n.K)(p=>{throw new Error(p.error.message)})).subscribe(p=>{const m=this.archives$.getValue(),{page:h,limit:v}=m;this.getArchives(h,v)})}searchDefinitions(a){return this.http.GET(`${_}/paper-archive-definitions/search?query=${a}`)}}return f.\u0275fac=function(a){return new(a||f)(A.LFG(e.O))},f.\u0275prov=A.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},2350:(I,T,r)=>{r.d(T,{N:()=>s});var Z=r(273),n=r(3668),c=r(4437),A=r(1109),e=r(8063),_=r(2606),u=r(1769);const f=function(p){return{key:"Classified Into",value:p}},C=function(p){return{key:"Form Date Time",type:"date",value:p}};let s=(()=>{class p{constructor(h,v){this.dialogRef=h,this.archiveService=v,this.onClose=new Z.x}ngOnInit(){}get imageSrc(){return`climsoft/${this.archive.image}`}onCancel(){this.onClose.next(!1),this.dialogRef.hide()}}return p.\u0275fac=function(h){return new(h||p)(n.Y36(c.UZ),n.Y36(A.f))},p.\u0275cmp=n.Xpm({type:p,selectors:[["app-archive-viewer"]],inputs:{archive:"archive"},decls:15,vars:7,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"modal-close",3,"click"],["cIcon","","name","cilX"],[1,"modal-body"],["xs","12","md","6"],[3,"config"],["md","12",1,"p-3"],[1,"image-wrapper","mh-12"],["alt","",3,"src"]],template:function(h,v){1&h&&(n.TgZ(0,"div",0),n.TgZ(1,"h5",1),n._uU(2,"View Paper Archive"),n.qZA(),n.TgZ(3,"button",2),n.NdJ("click",function(){return v.onCancel()}),n.O4$(),n._UZ(4,"svg",3),n.qZA(),n.qZA(),n.kcU(),n.TgZ(5,"div",4),n.TgZ(6,"c-row"),n.TgZ(7,"c-col",5),n._UZ(8,"app-info-block",6),n.qZA(),n.TgZ(9,"c-col",5),n._UZ(10,"app-info-block",6),n.qZA(),n.qZA(),n.TgZ(11,"c-row"),n.TgZ(12,"c-col",7),n.TgZ(13,"div",8),n._UZ(14,"img",9),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&h&&(n.xp6(8),n.Q6J("config",n.VKq(3,f,v.archive.classified_into)),n.xp6(2),n.Q6J("config",n.VKq(5,C,v.archive.form_datetime)),n.xp6(4),n.Q6J("src",v.imageSrc,n.LSH))},directives:[e.ar,_.iok,_.Yp0,u.t],styles:[".image-wrapper[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #888}.image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}"]}),p})()}}]);